{
  "name": "PROJECT",
  "dockerComposeFile": "docker-compose.yml",
  "service": "devcontainer",
  "workspaceFolder": "/workspace",
  "remoteUser": "node",

  // Forward SSH agent and Git credentials from host
  "mounts": [
    "source=${localEnv:HOME}/.ssh,target=/home/node/.ssh,type=bind,readonly",
    "source=${localEnv:HOME}/.gitconfig,target=/home/node/.gitconfig,type=bind,readonly"
  ],

  // VS Code / Cursor extensions to install inside the container
  "customizations": {
    "vscode": {
      "extensions": [
        // Core
        "dbaeumer.vscode-eslint",
        "esbenp.prettier-vscode",
        "ms-vscode.vscode-typescript-next",

        // Docker
        "ms-azuretools.vscode-docker",

        // YAML / TOML
        "redhat.vscode-yaml",
        "tamasfe.even-better-toml",

        // Utilities
        "christian-kohler.path-intellisense",
        "streetsidesoftware.code-spell-checker",
        "EditorConfig.EditorConfig"
      ],
      "settings": {
        // Editor
        "editor.formatOnSave": true,
        "editor.defaultFormatter": "esbenp.prettier-vscode",
        "typescript.tsdk": "/workspace/node_modules/typescript/lib",
        "files.trimTrailingWhitespace": true,
        "files.insertFinalNewline": true,
        "[typescript]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode"
        },
        "[json]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode"
        },
        "[yaml]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode"
        },

        // Terminal: shell & behavior
        "terminal.integrated.defaultProfile.linux": "bash",
        "terminal.integrated.shellIntegration.enabled": true,
        "terminal.integrated.enablePersistentSessions": true,
        "terminal.integrated.scrollback": 10000,
        "terminal.integrated.cursorBlinking": true,
        "terminal.integrated.cursorStyle": "line",
        "terminal.integrated.fontSize": 13,

        // Terminal: environment
        "terminal.integrated.inheritEnv": true,
        "terminal.integrated.env.linux": {
          "EDITOR": "cursor --wait",
          "VISUAL": "cursor --wait"
        }
      }
    }
  },

  // Commands to run after the container is created (once)
  "postCreateCommand": "bash -c 'cd /workspace && if [ -f package.json ]; then bun install; fi'",

  // Commands to run every time the container starts
  "postStartCommand": "sudo git config --system safe.directory /workspace && if [ -f /workspace/.envrc ]; then direnv allow /workspace; fi",

  // Features: add common utilities
  "features": {
    // Git LFS support
    "ghcr.io/devcontainers/features/git-lfs:1": {},
    // Docker CLI + socket permissions (docker-outside-of-docker)
    // moby=false required for Debian Trixie (moby-cli removed from Trixie repos)
    "ghcr.io/devcontainers/features/docker-outside-of-docker:1": {
      "moby": false
    }
  },

  // Environment variables forwarded from host
  "remoteEnv": {
    "GITHUB_TOKEN": "${localEnv:GITHUB_TOKEN}",
    "GH_TOKEN": "${localEnv:GITHUB_TOKEN}",
    "GT_TOKEN": "${localEnv:GT_TOKEN}"
  }
}
